# Instructions for running the coupled model
# after compilation of the code

# reset WorkingDir
tcsh
setenv WorkingDir /discover/nobackup/estrobac/Heracles-5_4
mkdir $WorkingDir

# Set GEOS-5 and MITgcm environment variables
cd $WorkingDir/GEOSodas/src
source g5_modules
setenv ESMA_NOCVS
setenv MITGCM_ROOT $WorkingDir/MITgcm
setenv GMAO_MITGCM_COUPLNG $WorkingDir/GEOSodas/src/GEOSgcs_GridComp/GEOSgcm_GridComp/GEOSogcm_GridComp/GEOSocean_GridComp/GuestOcean_GridComp/gmao_mitgcm_couplng
cd $GMAO_MITGCM_COUPLNG
./set_mitgcm_env.sh
setenv MPI_INC_DIR /usr/local/other/SLES11.1/mvapich2/1.8.1/intel-13.1.2.183/include

# Set up coupled code for experiments/exp01
# Be sure to replace "Desired Location" and "Build"
# directories below with your own
cd $WorkingDir/GEOSodas/src/Applications/GEOSgcm_App
./gcm_setup
# Enter the Experiment ID: TEST
# Enter a 1-line Experiment Description: TEST
# Do you wish to CLONE an old experiment? NO
# Enter the Atmospheric Horizontal Resolution code: c12
# Enter the Atmospheric Model Vertical Resolution: 72
# Do you wish to run the COUPLED Ocean/Sea-Ice Model? YES
# Enter the Ocean Lat/Lon Horizontal Resolution: c32
# Enter the Ocean Model Vertical Resolution: 15
# Enter the choice of  Land Surface Model: 1
# Do you wish to run  the Runoff Routing Model? NO
# Do you wish to run GOCART with Actual or Climatological Aerosols? C
# Enter the tag or directory: Current
# Enter Desired Location for HOME: /discover/nobackup/dmenemen/Heracles-5_4/TEST
# Enter Desired Location for EXPERIMENT: /discover/nobackup/dmenemen/Heracles-5_4/TEST
# Enter Location for Build directory: /discover/nobackup/dmenemen/Heracles-5_4/GEOSodas
# Enter your GROUP ID for Current EXP: s1353


# Get GEOS-5 boundary conditions for experiments/exp01
cd $WorkingDir
tar -xf /discover/nobackup/dmenemen/geos5/tarballs_100816/geos5-tiny.tgz
cd $WorkingDir/geos5/TEST
$GMAO_MITGCM_COUPLNG/experiments/exp01/makeoneday.bash TINY
cp $GMAO_MITGCM_COUPLNG/experiments/exp01/HISTORY.rc .

# Run coupled code
# Some verification output in $GMAO_MITGCM_COUPLNG/experiments/exp01/verification
cd $WorkingDir/geos5/TEST
# change the wall time in gcm_run.j (default is 15 minutes)
# set the start date in CAP.rc and in cap_restart
# set end data and segments in CAP.rc
sbatch --mail-user=estrobac ./gcm_run.j




