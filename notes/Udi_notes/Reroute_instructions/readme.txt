# For running the reroute file one needs:
# 1. mask file ( this is generated by running an experiment with MASKO in HISTORY.rc, see below)
# 2. tile file
# 3. routing table
# 4. data.exch2

#Create working directory
mkdir $WorkDir
# cd and copy the files to working directory
cd $WorkDir

# this extracts the blanklist to a file blanklist.txt
sed -n -e '/blankList.*=.*/,$p' data.exch2 | sed 's/blankList//g' | tr -d = | tr -d "\n" | tr -d " " | tr -d "&" | sed 's/.$//' > blanklist.txt

# inside reroute.py link the files:
#   gfile - the mask file
#   runoff_table - the routing table
#   tfile - the tile file
# and change nps to the number of processors

# compile reroute.f90
# These modules may be needed
# module load other/comp/gcc-5.3-sp3
# module load other/SSSO_Ana-PyD/SApd_4.2.0_py2.7_gcc-5.3-sp3

f2py -c -m reroute3 reroute3.f90

# run the reroute script:

python reroute.py

##################################################################################################

To output mask from coupled run add this collection to HISTORY.rc:

  mit_mask.template:  '%y4%m2%d2_%h2%n2z.nc4',
  mit_mask.archive:   '%c/Y%y4',
  mit_mask.format: 'CFIO',
  mit_mask.frequency: 010000,
  mit_mask.fields: 'MASKO' , 'OCEAN' ,
       ::

Add also mit_mask to the list of collections (COLLECTIONS)

